<div class="scenario-designer-container">
  <canvas #canvas class="scenario-canvas"></canvas>

  <mat-card class="scenario-toolbar">
    @if (!editMode) {
      <form [formGroup]="form">
        <mat-form-field appearance="fill" class="full-width">
          <mat-label>Scenario Name</mat-label>
          <input matInput formControlName="name" required />
          @if (form.controls['name'].hasError('required') && form.controls['name'].touched) {
            <mat-error> Name is required </mat-error>
          }
          @if (form.controls['name'].hasError('pattern') && form.controls['name'].touched) {
            <mat-error> Invalid name format </mat-error>
          }
        </mat-form-field>
      </form>

      <div class="toolbar-actions">
        <button mat-stroked-button color="primary" (click)="addEmitter()">Add Emitter</button>
        <button mat-stroked-button color="accent" (click)="addListener()">Add Listener</button>
      </div>
    }

    @if (selectedObject) {
      @if (!editMode) {
        <app-designed-object-info
          [selectedObject]="selectedObject"
          [editMode]="editMode"
          (delete)="deleteSelected()"
          (edit)="enterEditMode()"
        ></app-designed-object-info>
      }

      @if (editMode && selectedObject.type === 'emitter') {
        <app-emitter-editor
          [designedEmitter]="selectedObject"
          (save)="onEditorSave($event)"
          (cancel)="onEditorCancel()"
          (objectTransformChanged)="onObjectTransformChanged()"
        ></app-emitter-editor>
      } @else if (editMode && selectedObject.type === 'listener') {
        <app-listener-editor
          [designedListener]="selectedObject"
          (save)="onEditorSave($event)"
          (cancel)="onEditorCancel()"
          (objectTransformChanged)="onObjectTransformChanged()"
        ></app-listener-editor>
      }
    }
  </mat-card>
</div>
